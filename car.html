<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/public.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/car.css">
    <style>
    img{width:50px;height:50px;}
    </style>
</head>
<body>
        <header>
                <div id="margin" style="width: 990px">
                    <ul class="headerLeft">
                        <li id="gome-user">
                            <a href="#">国美会员<i class="ph"></i></a>
                            <div class="public-dropdown">
                                <div id="user-name">
                                    <i></i>
                                    <div>
                                            <p class="use-name-login">
                                                欢迎来到国美,
                                                <a href="#">请登录！</a>
                                            </p>
                                    </div>
                                </div>
                                <div id="user-icon">
                                    <p>
                                        <a href="#">会员俱乐部</a>
                                        <span>我的特权</span>
                                    </p>
                                    <div class="user-swiper">
                                        <ul>
                                            <li>
                                                <a href="#">
                                                    <i class="gm-icon"></i>
                                                    美豆抽奖
                                                </a>
                                                <a href="#">
                                                    <i class="gm-icon"></i>
                                                    退换货保障
                                                </a>
                                                <a href="#">
                                                    <i class="gm-icon"></i>
                                                    价格保护
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#">
                                                    <i class="gm-icon"></i>
                                                    消费得美豆
                                                </a>
                                                <a href="#">
                                                    <i class="gm-icon"></i>
                                                    专属阶梯价
                                                </a>
                                                 <a href="#">
                                                    <i class="gm-icon"></i>
                                                    生日礼包
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#">
                                                    <i class="gm-icon"></i>
                                                    更多精彩
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
        
                            </div>
                        </li>
                        <li id="denglu"><a href="#">登陆</a></li>
                        <li id="zhuce"><a href="login.html">注册有礼</a></li><i></i>
                    </ul>
                    <ul class="headerRight">
                        <li><a href="#">我的订单</a></li>
                        <li id='gome-mygome'>
                            <b><a href="#">我的国美</a><i></i></b>
                            <div class="public-dropdown">
                                <strong>
                                    我的国美
                                    <a href="#">请登录</a>
                                </strong>
                                <ul id="mygome-order">
                                    <li><a href="#">待处理订单</a></li>
                                    <li><a href="#">我的收藏</a></li>
                                    <li><a href="#">个人资料</a></li>
                                    <li><a href="#">我的美店</a></li>
                                </ul>
                                <ul id="mygome-coupon">
                                    <li><a href="#">我的优惠券</a></li>
                                </ul>
                                <p>足迹</p>
                            </div>
                        </li>
                        <li id="gome-enterprise">
                            <b><a href="#">企业采购</a><i></i></b>
                            <div class="public-dropdown">
                                    <a href="#" class="gome-hezuo"></a>
                            </div>
                        </li>
                        <li id="gome-service">
                            <b><a href="#">服务中心</a><i></i></b>
                            <div class="public-dropdown">
                                <p><a href="#">用户服务</a></p>
                                <ul>
                                    <li><a href="#">售后服务</a></li>
                                    <li><a href="#">帮助服务</a></li>
                                    <li><a href="#">新手指南</a></li>
                                    <li><a href="#">客服服务</a></li>
                                    <li><a href="#">用户注销</a></li>
                                </ul>
                                <p><a href="#">商家服务</a></p>
                                <ul>
                                    <li><a href="#">商家入驻</a></li>
                                    <li><a href="#">商家登录</a></li>
                                    <li><a href="#">广告平台</a></li>
                                    <li><a href="#">平台规则</a></li>
                                    <li><a href="#">商家培训</a></li>
                                </ul>
                                <a href="#" class="service-a">在线客服</a>
                            </div>
                        </li>
                        <li><b><a href="#">网站导航</a><i></i></b></li>
                        <li><b><a href="#">手机国美</a><i></i></b></li>
                    </ul>
                </div>
            </header>

    <section id="gome-head" >
        <div class="w990">
            <div class="logo">
                <a href="#" style="background-image: url(img/logo.png);float:left;width: 125px;"></a>
                <a href="#" style="background-image: url(img/car.png);float:left;width: 125px;"></a>
            </div>
        </div>
    </section>

    <section class="car-lists">
        <div class="car-container">
            <div class="car-empty">
                <div class="car-empty-icon" style="width: 71px;height: 54px;
                background-image: url(img/sprit.png);background-position: -576px 0;"></div>
                <div class="car-empty-text">
                    购物车内暂无商品，登录后将显示您之前加入的商品<br>
                    <div style="margin-top: 8px">
                        <div style="padding: 0px 15px 0px 0px; display: block;">
                            <a href="login.html" style="color:white;float: left;" class="car-empty-btn">登录</a>
                        </div>
                        <a href="index.html" style="line-height:29px;">挑选商品></a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- <table border="1" width="600" align="center">
        <thead>
            <tr>
                <th>选择</th>
                <th>图片</th>
                <th>名字</th>
                <th>单价</th>
                <th>数量</th>
                <th>总价</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table> -->

    <section id="gome-foot">
            <div id="gome-foot-box">
                <ul>
                    <li><a href="#">国美控股集团</a></li>
                    <li><a href="#">国美管家</a></li>
                    <li><a href="#">关于国美</a></li>
                    <li><a href="#">加入我们</a></li>
                    <li><a href="#">|</a></li>
                    <li><a href="#">品牌大全</a></li>
                    <li><a href="#">商品专题</a></li>
                    <li><a href="#">商品词</a></li>
                    <li><a href="#">热词搜索</a></li>
                    <li><a href="#">友情链接</a></li>
                    <li><a href="#">风险监测</a></li>
                    <li><a href="#">|</a></li>
                    <li><a href="#">销售联盟</a></li>
                    <li><a href="#">商家入驻</a></li>
                    <li><a href="#">广告营销</a></li>
                </ul>
                <p>
                    本公司游戏产品适合18岁以上成年人使用  违法和不良信息举报电话：021-39900132 
                    <a href="#">互联网药品信息服务资格证编号（沪）-经营性-2019-0006</a>
                </p>
                <p>
                    网络食品销售第三方平台提供者备案：沪网食备A0015号 
                    <a href="#">网络文化经营许可证沪网文[2017]5537-436号</a>
                    <a href="#">增值电信业务经营许可证</a>
                </p>
                <p>
                    客服电话:4008113333  
                    <a href="#">沪ICP备11009419号/京ICP备 19011786号</a>  
                    <a href="#">京B2-20191290</a>  
                    <a href="#">经营执照</a>  
                    <a href="#">营业执照</a>  
                    <a href="#">出版物经营许可证</a>
                </p>
                <p>
                    ©2000-2019  国美在线电子商务有限公司版权所有  
                    <a href="#" class="tw-w-ico-wrap">
                        <i class="tw-w-mark-icon"></i>
                        京公网安备 11010502038379号
                    </a>
                </p>
                <div class="gome-foot-credit">
                    <a href="#" class="credit-baxx">
                        <i></i>
                        <b>经营性网站备案信息</b>
                    </a>
                    <a href="#" class="credit-xypj">
                        <i></i>
                        <b>可信网站信用评价</b>
                    </a>
                    <a href="#" class="credit-cxwz">
                        <i></i>
                        <b>诚信网站</b>
                    </a>
                    <a href="#" class="credit-hdjc">
                        <i></i>
                        <b>朝阳网络警察</b>
                    </a>
                    <a href="#" class="credit-wgdj">
                        <i></i>
                        <b>网购大家评</b>
                    </a>
                    <a href="#" class="credit-report">
                        <i></i>
                        <b>上海市互联网违法和不良信息举报中心</b>
                    </a>
                </div>
            </div>
    </section>
    <script src="js/ajax.2.0.js"></script>
    <script src='../jquery.js'></script>
    <script src="../cookie.js"></script>
    <script>
    class Car{
        constructor(){
            this.tbody=document.querySelector('tbody');
            this.num1=0;
            this.sum1=0;
            this.flag=0;
            this.load();
            this.addEvent();
        }
        load(){
            var that=this;
            $.ajax({
                url:"http://127.0.0.1/shopping/data/goods.json",
                success:function(a,b,c){
                    that.res=a;
                    that.setlocal();
                },
            })
        }
        setlocal(){
            this.goods=localStorage.getItem('goods')? JSON.parse(localStorage.getItem('goods')):[];

            this.display();
        }
        display(){
            var str="";
            for(var i=0;i<this.res.length;i++){
                for(var j=0;j<this.goods.length;j++){
                    if(this.res[i].goodsId == this.goods[j].id){
                        // this.num1+=parseInt(this.goods[j].num);
                        // this.sum1+=this.res[i].price*this.goods[j].num;
                        str+=`<tr index="${this.res[i].goodsId}">
                            <td><input type="checkbox" name="good" class="good"></td>
                            <td><img src="${this.res[i].url}"></td>
                            <td>${this.res[i].name}</td>
                            <td>${this.res[i].price}</td>
                            <td><input type="number" value="${this.goods[j].num}" class="num"></td>
                            <td class="priceSum">${this.res[i].price*this.goods[j].num}</td>
                            <td class="delete">删除</td>
                        </tr>`
                    }
                }
            }
            str+=`<tr>
                    <td>全选:<input type="checkbox" class="boxId" id="bbox"></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td id="snum">${this.num1}</td>
                    <td id="ssum">${this.sum1}</td>
                    <td></td>
                </tr>`
            this.tbody.innerHTML=str;
        }
        addEvent(){
            var that=this;
            $('tbody').on('click.qwe',function(){
                var tar=event.target;
                if(tar.name=="good"){
                        var str="";
                        var s=0;
                        for(var i=0;i<$('.good').length;i++){
                            if(!$('.good').eq(i)[0].checked){
                                $('.boxId')[0].checked=false;
                                that.flag=0;
                            }
                        }
                        for(var i=0;i<$('.good').length;i++){
                            if($('.good').eq(i)[0].checked){
                                s+=1;
                                console.log($('.good').length,s);
                                if(s==$('.good').length){
                                    $('#bbox')[0].checked=true;
                                }
                            }
                        }
                        if(tar.checked){
                            that.id= $(tar).parent().parent().attr("index");
                            that.goods=localStorage.getItem('goods')? JSON.parse(localStorage.getItem('goods')):[];
                            for(var j=0;j<that.goods.length;j++){
                            if(that.goods[j].id==that.id){
                                that.num1+=parseInt(that.goods[j].num);
                                that.sum1+=parseInt(that.goods[j].num*$(tar).parent().parent().children().next().next().next().html());
                                
                            }}
                            $('#snum').html(that.num1);
                            $('#ssum').html(that.sum1);
                         
                        }else{
                            that.id=tar.parentNode.parentNode.getAttribute("index");
                            that.goods=localStorage.getItem('goods')? JSON.parse(localStorage.getItem('goods')):[];
                            for(var j=0;j<that.goods.length;j++){
                            if(that.goods[j].id==that.id){
                                that.num1-=parseInt(that.goods[j].num);
                                that.sum1-=parseInt(that.goods[j].num*$(tar).parent().parent().children().next().next().next().html());
                            }}
                            $('#snum').html(that.num1);
                            $('#ssum').html(that.sum1);
                        }
                }

                if(tar.className == "delete"){
                    that.id= $(tar).parent().attr("index");
                    $(tar).parent().remove();
                    that.setLocal(function(i){
                        that.goods.splice(i,1)
                    })
                }

                if(tar.className=="num"){
                    that.val = $(tar).val();
                    that.id =  $(tar).parent().parent().attr("index");
                    var numA=0;
                    var priceA=0;
                    that.setLocal(function(i){
                        that.goods[i].num = that.val;
                    })
                    for(var i=0;i<$('.num').length;i++){
                    if($('.num').eq(i).parent().parent().find('.good')[0].checked){
                        var te=parseInt($('.num').eq(i).val());
                        numA+=te;
                        var tt=parseInt($('.num').eq(i).val()*$(tar).parent().prev().html());
                        priceA+=tt;
                    }}
                    $('#snum').html(numA);
                    $('#ssum').html(priceA);
                    that.num1=numA;
                    that.sum1=priceA;
                    $(tar).parent().next().html(that.val*$(tar).parent().prev().html())
                    // that.display();
                }

                if(tar.className=="boxId"){
                    var numA=0;
                    var priceA=0;
                    this.num1=0;
                    this.sum1=0;
                    if(that.flag==0){
                        for(var i=0;i<$('.good').length;i++){
                            $('.good')[i].checked=true;
                        }
                        that.flag=1;
                        for(var i=0;i<$('.num').length;i++){
                            numA+=parseInt($('.num').eq(i).val());
                            priceA+=parseInt($('.priceSum').eq(i).html());
                        }
                        $('#snum').html(numA);
                        $('#ssum').html(priceA);
                        that.num1=numA;
                        that.sum1=priceA;
                    }else{
                        for(var i=0;i<$('.good').length;i++){
                            $('.good')[i].checked=false;
                        }
                        that.flag=0;
                        that.sum1=0;
                        that.num1=0;
                        $('#snum').html(0);
                        $('#ssum').html(0);
                    }
                }
            })
        }
        setLocal(fn){
            for(var i=0;i<this.goods.length;i++){
                if(this.goods[i].id == this.id){
                    fn(i);
                }
            }
            localStorage.setItem("goods",JSON.stringify(this.goods));
        }
    }

    new Car();

    console.log(getCookie('name'))
    if(getCookie('loginon')=='true'){
        console.log($('.use-name-login').children().html());
        $('.use-name-login').children().html(getCookie('name'))
        $('#denglu').children().html('欢迎您 '+getCookie('name'))
        $('#zhuce').css('display','none');
        $('#zhuce').next().css('display','none');
        $('.car-empty-btn').css('display','none');
    }
    </script>
</body>
</html>